# Архитектура системы

Для обеспечения связи между клиентским устройством и основными исполнительными устройствами системы «Умный дом» необходимо обеспечить передачу сообщений по протоколу MQTT. Учитывая, что для защищенности системы необходимо создавать локальный MQTT-брокер, на сервере, где это будет сделано можно выполнять и другие задачи, например сохранять необходимые результаты в базу данных.

![image](https://github.com/user-attachments/assets/6db3e3f4-d624-4fcc-82a5-3f0fc9590b9a)

Пользовательские устройства подключены к локальной сети или получают доступ в нее извне. С целью разгрузки основной сети от подключения большого числа устройств системы «Умный дом» такие устройства подключаются к своей сети, которая связана с основной. Так же к этой сети подключен сервер, на котором запускается MQTT-брокер и выполняется подключение к базе данных. При такой организации сети получается, что независимо от нагрузки на основную точку доступа, например при скачивании больших файлов сторонними устройствами, не относящимися к системе, трафик между сервером и исполнительными устройствами не снижается, а при передаче сообщений с состояниями системы, которые могут меняться десятки раз в минуту это важно для избежания задержек. Кроме того, разделение трафика позволяет еще больше изолировать систему от возможности доступа к ней. Пароль от домашнего интернета могут знать гости и он хранится в файлах различных приложений и сервисов, в то время как пароль от внутренней сети системы «Умный дом» не нужен для взаимодействия с ней и нет необходимости предоставлять его сторонним источникам.

# Серверная часть

При работе системы в ней появляются данные, которые необходимо хранить в том числе при отключении системы, то-есть хранение должно быть энергонезависимым. Каждое из этих значений можно было бы хранить на конкретном устройстве исполнения в flash-памяти, а данные о пользователях на смартфонах. Такой тип хранения информации является децентрализованным, что несет риск получения доступа к системе, поскольку пользовательские устройства имеют доступ в глобальную сеть и данные с них могут быть получены множественными способами атак. В то же время централизованная система, когда все клиенты зависят от одного главного устройства, имеет недостаток в виде невозможности взаимодействия с системой при выходе этого устройства из строя. Однако, поскольку был выбран протокол взаимодействия MQTT, то в случае выхода из строя серверного устройства взаимодействие с системой уже будет невозможно. Данный риск устраняется аппаратным способом - сервер должен иметь стабильное питание, достаточную производительность, постоянное подключение к сети Интернет, а его операционная система не должна давать сбоев и самостоятельно обновляться.
В качестве сервера используется компьютер с установленной ОС Linux Ubuntu. Запуск брокера осуществляется после установки и настройки программы mosquitto.

схема бд:

![image](https://github.com/user-attachments/assets/f17dea6c-ba3c-4dfd-9692-4d19b49ff0b5)

# Пользовательское приложение

диаграмма классов

![image](https://github.com/user-attachments/assets/5642abf8-05d8-4966-ad12-939664ba6754)

Роли доступа 

●	Администратор - имеет права на получение данных со всех устройств системы и изменение их где это может быть необходимо, например, обнуление показателей счетчиков расхода воды при их замене, может добавлять новые устройства в систему, просматривать и удалять аккаунты пользователей, менять их роли.
●	Член семьи - имеет возможность просматривать все показания с датчиков, но не может их изменять. Не имеет доступа к списку пользователей и не может добавлять новые устройства. 
●	Гость - пользователь с минимальными правами на доступ к системе, так же, как и “член семьи” не может просматривать других пользователей, не может добавлять новые устройства в систему. Не имеет доступа к показателям датчиков системы и может выполнять только те действия, которые назначит администратор. Такая роль полезна тем, что владелец системы сам сможет настроить, например, какое освещение будет доступно для управления такому пользователю, в том помещении, где ему это действительно может быть необходимо.

ссостояния для авторизации 

![image](https://github.com/user-attachments/assets/ebf48601-9de8-4cb1-815d-ddf301b8c22b)

# Исполнительная часть

К системе подключаются модули исполнения, с которыми взаимодействует пользователь через приложение на смартфоне. Полный набор подключенных к системе модулей будем называть исполнительной частью системы, поскольку каждый из них может быть связан с другими и только вместе они реализуют общую концепцию термина «Умный дом».  Таких модулей может быть неограниченное количество, каждый из них добавляется в базу данных под своим уникальным именем и отображается при помощи него в приложении со всеми статусами и состояниями. 
Каждый из модулей исполнительной части может включать в себя от одного до нескольких датчиков и исполнительных устройств, которые поддерживает система. К ним относятся:
●	Шаговый двигатель
●	реле
●	кнопка
●	адресная светодиодная лента
●	датчик движения
●	датчик освещенности
●	датчик влажности и температуры
Для каждого из таких устройств в прошивке контроллера содержится структура, через которую имеется возможность создать любое количество экземпляров и получить параметры каждого из них отдельно.
Все созданные экземпляры периферийных устройств содержатся в массивах, а программа в бесконечном цикле проходит все их элементы и отслеживает состояния. Использование парадигмы объектно ориентированного программирования позволяет без вмешательства в исполняемый код добавлять или удалять подключенные устройства, а также менять конфигурацию любого из модулей выполнения. 

диаграмма классов 

![image](https://github.com/user-attachments/assets/ea237eaa-87f6-4dd2-b1a5-f22a01051a9b)

пример сборки модуля освещения

![image](https://github.com/user-attachments/assets/ae885bdc-2292-438d-9e32-d3ee71b690cf)

